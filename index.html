<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dodge the Rocks+</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle, #0b0b24, #000);
      overflow: hidden;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #gameContainer {
      position: relative;
      margin: 30px auto;
      border: 3px solid white;
      width: 700px;
      height: 500px;
      overflow: hidden;
      background: linear-gradient(to bottom, #111, #222);
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    #ui {
      margin-top: 10px;
    }
    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover { background: #005fcc; }
  </style>
</head>
<body>
  <h1>Dodge the Rocks+</h1>
  <div id="gameContainer">
    <canvas id="game" width="700" height="500"></canvas>
  </div>
  <div id="ui">
    <p>Use arrow keys to move. Space to shoot (if you have the power-up).</p>
    <button id="startBtn">Start Game</button>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const startBtn = document.getElementById("startBtn");

    const player = { x: 330, y: 450, size: 30, speed: 5, color: "lime", canShoot: false };
    let rocks = [], bullets = [], powerUps = [];
    let score = 0, gameOver = false, gameRunning = false;
    let rockSpeed = 3, powerTimers = { speed: 0, slow: 0 };

    const keys = {};
    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    function resetGame() {
      player.x = 330;
      player.y = 450;
      rocks = [];
      bullets = [];
      powerUps = [];
      score = 0;
      rockSpeed = 3;
      player.canShoot = false;
      powerTimers = { speed: 0, slow: 0 };
      gameOver = false;
    }

    function spawnRock() {
      rocks.push({
        x: Math.random() * (canvas.width - 20),
        y: -20,
        size: 20 + Math.random() * 20,
      });
    }

    function spawnPowerUp() {
      const types = ["shoot", "speed", "slow"];
      const type = types[Math.floor(Math.random() * types.length)];
      powerUps.push({
        x: Math.random() * (canvas.width - 20),
        y: -20,
        size: 20,
        type
      });
    }

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.size, player.size);
    }

    function drawRocks() {
      ctx.fillStyle = "gray";
      rocks.forEach(r => ctx.fillRect(r.x, r.y, r.size, r.size));
    }

    function drawBullets() {
      ctx.fillStyle = "yellow";
      bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));
    }

    function drawPowerUps() {
      powerUps.forEach(p => {
        ctx.fillStyle = p.type === "shoot" ? "red" : p.type === "speed" ? "blue" : "purple";
        ctx.beginPath();
        ctx.arc(p.x + 10, p.y + 10, p.size / 2, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function update() {
      // Movement
      let moveSpeed = player.speed;
      if (powerTimers.speed > 0) moveSpeed = 8;
      if (keys["ArrowLeft"] && player.x > 0) player.x -= moveSpeed;
      if (keys["ArrowRight"] && player.x + player.size < canvas.width) player.x += moveSpeed;
      if (keys["ArrowUp"] && player.y > 0) player.y -= moveSpeed;
      if (keys["ArrowDown"] && player.y + player.size < canvas.height) player.y += moveSpeed;

      // Shooting
      if (player.canShoot && keys[" "] && bullets.length < 5) {
        bullets.push({ x: player.x + player.size / 2 - 2, y: player.y });
      }

      // Update bullets
      bullets.forEach(b => b.y -= 8);
      bullets = bullets.filter(b => b.y > -10);

      // Update rocks
      const fallSpeed = powerTimers.slow > 0 ? rockSpeed / 2 : rockSpeed;
      rocks.forEach(r => r.y += fallSpeed);
      rocks = rocks.filter(r => r.y < canvas.height + 30);

      // Update power-ups
      powerUps.forEach(p => p.y += 2);
      powerUps = powerUps.filter(p => p.y < canvas.height + 30);

      // Collisions
      rocks.forEach((r, ri) => {
        // Player collision
        if (r.x < player.x + player.size && r.x + r.size > player.x &&
            r.y < player.y + player.size && r.y + r.size > player.y) {
          gameOver = true;
        }

        // Bullet collision
        bullets.forEach((b, bi) => {
          if (b.x < r.x + r.size && b.x + 4 > r.x && b.y < r.y + r.size && b.y + 10 > r.y) {
            rocks.splice(ri, 1);
            bullets.splice(bi, 1);
            score += 5;
          }
        });
      });

      // Power-up pickup
      powerUps.forEach((p, pi) => {
        if (p.x < player.x + player.size && p.x + p.size > player.x &&
            p.y < player.y + player.size && p.y + p.size > player.y) {
          if (p.type === "shoot") player.canShoot = true;
          if (p.type === "speed") powerTimers.speed = 300;
          if (p.type === "slow") powerTimers.slow = 300;
          powerUps.splice(pi, 1);
        }
      });

      // Timers
      if (powerTimers.speed > 0) powerTimers.speed--;
      if (powerTimers.slow > 0) powerTimers.slow--;

      // Score and spawn
      if (Math.random() < 0.02) spawnRock();
      if (Math.random() < 0.005) spawnPowerUp();
      score++;
    }

    function drawUI() {
      ctx.fillStyle = "white";
      ctx.font = "16px Arial";
      ctx.fillText("Score: " + score, 10, 20);
      if (player.canShoot) ctx.fillText("Shoot Ready", 10, 40);
      if (powerTimers.speed > 0) ctx.fillText("Speed Boost!", 10, 60);
      if (powerTimers.slow > 0) ctx.fillText("Slow Motion!", 10, 80);
    }

    function loop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawRocks();
      drawBullets();
      drawPowerUps();
      drawUI();

      update();

      if (gameOver) {
        ctx.fillStyle = "red";
        ctx.font = "30px Arial";
        ctx.fillText("GAME OVER!", 250, 250);
        ctx.font = "20px Arial";
        ctx.fillText("Score: " + score, 300, 280);
        ctx.fillText("Press Start to Restart", 240, 310);
        gameRunning = false;
        return;
      }
      requestAnimationFrame(loop);
    }

    startBtn.addEventListener("click", () => {
      resetGame();
      gameRunning = true;
      loop();
    });
  </script>
</body>
</html>
